# 非機能要件詳細
**Non-Functional Requirements Specification for Time Series Forecasting System**

---

## 📋 ドキュメント情報

| 項目 | 内容 |
|-----|------|
| **ドキュメントタイトル** | 時系列予測システム 非機能要件詳細 |
| **バージョン** | v1.0.0 |
| **作成日** | 2025-11-03 |
| **最終更新日** | 2025-11-03 |
| **対象システム** | NeuralForecast Auto Runner + Time Series Forecasting System |
| **対象読者** | アーキテクト、開発者、インフラエンジニア、QAエンジニア |

---

## 目次

1. [非機能要件の概要](#1-非機能要件の概要)
2. [パフォーマンス要件](#2-パフォーマンス要件)
3. [スケーラビリティ要件](#3-スケーラビリティ要件)
4. [可用性・信頼性要件](#4-可用性信頼性要件)
5. [セキュリティ要件](#5-セキュリティ要件)
6. [保守性・拡張性要件](#6-保守性拡張性要件)
7. [ユーザビリティ要件](#7-ユーザビリティ要件)
8. [互換性要件](#8-互換性要件)
9. [運用要件](#9-運用要件)
10. [データ管理要件](#10-データ管理要件)
11. [監視・ロギング要件](#11-監視ロギング要件)
12. [品質属性](#12-品質属性)
13. [制約事項](#13-制約事項)
14. [測定・検証方法](#14-測定検証方法)
15. [付録](#15-付録)

---

## 1. 非機能要件の概要

### 1.1 非機能要件の目的

本ドキュメントは、時系列予測システムの非機能要件を定義し、システムの品質特性を明確化します。

#### 主要目的

1. **システム品質の定義**: 性能、信頼性、セキュリティ等の明確な基準
2. **検証可能性の確保**: 測定可能な指標による要件定義
3. **優先順位の明確化**: 重要度に基づく実装優先度の決定
4. **リスク管理**: 非機能要件未達時のリスク把握
5. **合意形成**: ステークホルダー間での品質基準の共有

---

### 1.2 ISO/IEC 25010品質モデル

本システムの非機能要件は、ISO/IEC 25010品質モデルに基づきます：

```
┌─────────────────────────────────────────┐
│         製品品質モデル (ISO 25010)        │
├─────────────────────────────────────────┤
│ 1. 機能適合性 (Functional Suitability)  │
│ 2. 性能効率性 (Performance Efficiency)   │
│ 3. 互換性 (Compatibility)                │
│ 4. ユーザビリティ (Usability)            │
│ 5. 信頼性 (Reliability)                  │
│ 6. セキュリティ (Security)               │
│ 7. 保守性 (Maintainability)              │
│ 8. 移植性 (Portability)                  │
└─────────────────────────────────────────┘
```

---

### 1.3 優先度定義

| 優先度 | 説明 | 対応 |
|-------|------|------|
| **P0 - Critical** | システムの基本動作に必須 | 必ず実装 |
| **P1 - High** | ビジネス価値が高い | リリース前に実装 |
| **P2 - Medium** | あると望ましい | リソース次第で実装 |
| **P3 - Low** | 将来的な改善項目 | 次期バージョンで検討 |

---

## 2. パフォーマンス要件

### 2.1 応答時間要件

#### 2.1.1 学習・訓練

| 項目 | 目標値 | 上限値 | 優先度 | 測定方法 |
|-----|--------|--------|--------|---------|
| **単一モデル学習時間** | <5分 | <10分 | P0 | Wall clock time |
| **中規模データセット学習** (10万行) | <15分 | <30分 | P1 | Wall clock time |
| **大規模データセット学習** (100万行) | <2時間 | <4時間 | P2 | Wall clock time |
| **ハイパーパラメータ探索** (10試行) | <1時間 | <2時間 | P1 | Wall clock time |
| **ハイパーパラメータ探索** (100試行) | <10時間 | <20時間 | P2 | Wall clock time |

**測定条件**:
- CPU: 16コア以上
- GPU: RTX 3060以上（GPU使用時）
- メモリ: 32GB
- データ: 1,000 unique_id × 365日

---

#### 2.1.2 予測・推論

| 項目 | 目標値 | 上限値 | 優先度 | 測定方法 |
|-----|--------|--------|--------|---------|
| **単一予測レイテンシ** | <50ms | <100ms | P0 | time.perf_counter |
| **バッチ予測 (10件)** | <200ms | <500ms | P0 | time.perf_counter |
| **バッチ予測 (100件)** | <1秒 | <2秒 | P1 | time.perf_counter |
| **バッチ予測 (1,000件)** | <10秒 | <20秒 | P2 | time.perf_counter |
| **API応答時間** | <500ms | <1秒 | P1 | HTTP timing |

**測定条件**:
- 予測期間: 7ステップ先
- モデル: 学習済みAutoNHITS
- 入力データ: 最小限の特徴量

---

#### 2.1.3 データ処理

| 項目 | 目標値 | 上限値 | 優先度 | 測定方法 |
|-----|--------|--------|--------|---------|
| **CSV読み込み** (100MB) | <5秒 | <10秒 | P1 | time.perf_counter |
| **CSV読み込み** (1GB) | <30秒 | <60秒 | P1 | time.perf_counter |
| **CSV読み込み** (10GB) | <5分 | <10分 | P2 | time.perf_counter |
| **データ前処理** (100万行) | <30秒 | <60秒 | P1 | time.perf_counter |
| **特徴量生成** (100万行、10特徴量) | <2分 | <5分 | P1 | time.perf_counter |
| **データ検証** (100万行) | <10秒 | <30秒 | P2 | time.perf_counter |

---

#### 2.1.4 並列処理

| 項目 | 目標値 | 上限値 | 優先度 | 測定方法 |
|-----|--------|--------|--------|---------|
| **10モデル並列学習** | <30分 | <1時間 | P1 | Wall clock time |
| **100モデル並列学習** | <2時間 | <4時間 | P1 | Wall clock time |
| **並列実行オーバーヘッド** | <5% | <10% | P2 | 比較測定 |
| **Ray起動時間** | <10秒 | <30秒 | P2 | time.perf_counter |

**測定条件**:
- 並列数: CPUコア数 - 1
- Ray: ローカルモード
- 各モデル: 小規模データセット

---

### 2.2 スループット要件

#### 2.2.1 学習スループット

| 項目 | 目標値 | 優先度 | 測定方法 |
|-----|--------|--------|---------|
| **1日あたりの学習可能モデル数** | >100 | P1 | 24時間連続実行 |
| **1時間あたりの並列実行数** | >10 | P1 | ピーク時測定 |
| **同時実行可能ジョブ数** | ≥10 | P1 | リソース監視 |

---

#### 2.2.2 予測スループット

| 項目 | 目標値 | 優先度 | 測定方法 |
|-----|--------|--------|---------|
| **1秒あたりの予測数** | >100 | P1 | ベンチマーク |
| **1分あたりのバッチ予測数** | >1,000 | P1 | ベンチマーク |
| **API同時接続数** | ≥10 | P2 | 負荷テスト |

---

### 2.3 リソース使用量要件

#### 2.3.1 メモリ使用量

| 項目 | 目標値 | 上限値 | 優先度 | 測定方法 |
|-----|--------|--------|--------|---------|
| **ベースメモリ使用量** | <1GB | <2GB | P1 | psutil.virtual_memory |
| **単一モデル学習時** | <8GB | <16GB | P0 | psutil.virtual_memory |
| **10モデル並列学習時** | <32GB | <64GB | P1 | psutil.virtual_memory |
| **メモリリーク率** | 0% | <1%/日 | P1 | 長時間監視 |
| **予測時メモリ使用量** | <2GB | <4GB | P1 | psutil.virtual_memory |

---

#### 2.3.2 GPU使用量

| 項目 | 目標値 | 上限値 | 優先度 | 測定方法 |
|-----|--------|--------|--------|---------|
| **GPU VRAM使用量** | <8GB | <12GB | P1 | nvidia-smi |
| **GPU利用率** | >80% | >50% | P1 | nvidia-smi |
| **複数GPU負荷分散** | 均等±10% | 均等±20% | P2 | nvidia-smi |

---

#### 2.3.3 ディスク使用量

| 項目 | 目標値 | 上限値 | 優先度 | 測定方法 |
|-----|--------|--------|--------|---------|
| **モデルファイルサイズ** | <100MB/モデル | <500MB/モデル | P1 | os.path.getsize |
| **ログファイルサイズ** | <10MB/日 | <100MB/日 | P2 | du -sh |
| **データベースサイズ** | <1GB/1万Run | <10GB/1万Run | P2 | pg_database_size |
| **キャッシュサイズ** | <5GB | <20GB | P2 | du -sh |

---

#### 2.3.4 CPU使用率

| 項目 | 目標値 | 優先度 | 測定方法 |
|-----|--------|--------|---------|
| **アイドル時CPU使用率** | <5% | P2 | psutil.cpu_percent |
| **学習時CPU使用率** | >70% | P1 | psutil.cpu_percent |
| **予測時CPU使用率** | 30-50% | P2 | psutil.cpu_percent |

---

### 2.4 ネットワーク要件

| 項目 | 目標値 | 優先度 | 測定方法 |
|-----|--------|--------|---------|
| **API応答サイズ** | <1MB | P1 | Content-Length |
| **バッチ予測応答サイズ** | <10MB | P2 | Content-Length |
| **データアップロードサイズ** | ≤100MB | P1 | Content-Length |
| **MLflowトラッキング通信量** | <100MB/実験 | P2 | ネットワーク監視 |

---

### 2.5 パフォーマンス最適化戦略

#### 2.5.1 最適化技術

| 技術 | 適用箇所 | 効果 | 優先度 |
|-----|---------|------|--------|
| **モデル量子化** | 推論時 | メモリ削減50%、速度向上2x | P2 |
| **バッチ処理** | 予測時 | スループット向上10x | P1 |
| **キャッシング** | 設定読み込み | レイテンシ削減90% | P1 |
| **並列処理** | 学習時 | 実行時間削減N倍（Nコア） | P0 |
| **インデックス最適化** | データベース | クエリ速度向上10x | P1 |
| **接続プーリング** | データベース | 接続オーバーヘッド削減 | P1 |

---

#### 2.5.2 パフォーマンス監視

```python
# パフォーマンスメトリクスの定義
class PerformanceMetrics:
    """パフォーマンスメトリクス"""
    
    # 応答時間
    training_time_seconds: float  # 学習時間
    prediction_latency_ms: float  # 予測レイテンシ
    api_response_time_ms: float  # API応答時間
    
    # リソース使用量
    peak_memory_mb: float  # ピークメモリ
    avg_cpu_percent: float  # 平均CPU使用率
    gpu_memory_mb: float  # GPU VRAM使用量
    
    # スループット
    predictions_per_second: int  # 予測数/秒
    models_trained_per_hour: int  # 学習数/時
    
    # 効率性
    resource_utilization: float  # リソース利用率（0-1）
    parallelization_efficiency: float  # 並列化効率（0-1）
```

---

## 3. スケーラビリティ要件

### 3.1 水平スケーラビリティ

#### 3.1.1 並列実行数

| 項目 | 最小値 | 推奨値 | 最大値 | 優先度 |
|-----|--------|--------|--------|--------|
| **同時並列実行数** | 1 | 10 | 32 | P1 |
| **Rayワーカー数** | 1 | 8 | 64 | P2 |
| **GPUデバイス数** | 0 | 1 | 4 | P2 |
| **データベース接続プール** | 5 | 10 | 50 | P1 |

---

#### 3.1.2 データ量スケーラビリティ

| 項目 | 最小値 | 推奨値 | 最大値 | 優先度 |
|-----|--------|--------|--------|--------|
| **unique_id数** | 1 | 100 | 10,000 | P1 |
| **時系列長** (行/unique_id) | 30 | 365 | 100,000 | P1 |
| **総行数** | 30 | 36,500 | 1,000,000 | P1 |
| **特徴量数** | 3 | 20 | 1,000 | P2 |
| **データセットサイズ** | 1MB | 100MB | 10GB | P2 |

---

#### 3.1.3 実験数スケーラビリティ

| 項目 | 最小値 | 推奨値 | 最大値 | 優先度 |
|-----|--------|--------|--------|--------|
| **Experiment数** | 1 | 100 | 10,000 | P1 |
| **Run数/Experiment** | 1 | 100 | 10,000 | P1 |
| **総Run数** | 1 | 10,000 | 1,000,000 | P2 |
| **登録モデル数** | 1 | 100 | 10,000 | P2 |

---

### 3.2 垂直スケーラビリティ

#### 3.2.1 ハードウェアスケーリング

| リソース | 最小構成 | 推奨構成 | 最大構成 | 優先度 |
|---------|---------|---------|---------|--------|
| **CPU** | 4コア | 16コア | 64コア | P1 |
| **メモリ** | 16GB | 32GB | 128GB | P1 |
| **GPU** | なし | RTX 3060 (12GB) | A100 (80GB) × 4 | P2 |
| **ストレージ** | 100GB SSD | 500GB NVMe | 2TB NVMe | P1 |

---

### 3.3 スケーラビリティテスト

#### 3.3.1 負荷テストシナリオ

```python
# 負荷テストシナリオ定義
load_test_scenarios = [
    {
        "name": "10モデル並列学習",
        "concurrent_runs": 10,
        "dataset_size": "10万行",
        "duration": "1時間",
        "expected_completion": "<1時間",
        "success_criteria": "全モデル完了、エラー率<1%"
    },
    {
        "name": "100モデル並列学習",
        "concurrent_runs": 100,
        "dataset_size": "1万行",
        "duration": "4時間",
        "expected_completion": "<4時間",
        "success_criteria": "全モデル完了、エラー率<5%"
    },
    {
        "name": "高頻度API呼び出し",
        "requests_per_second": 100,
        "duration": "10分",
        "expected_latency": "<100ms (p95)",
        "success_criteria": "エラー率<0.1%"
    },
    {
        "name": "大規模データセット",
        "dataset_size": "100万行、1,000 unique_id",
        "model_count": 1,
        "expected_completion": "<4時間",
        "success_criteria": "完了、メモリ<64GB"
    }
]
```

---

## 4. 可用性・信頼性要件

### 4.1 可用性要件

#### 4.1.1 システム稼働率

| 項目 | 目標値 | 優先度 | 測定期間 |
|-----|--------|--------|---------|
| **月間稼働率** | ≥99.0% | P1 | 月次 |
| **四半期稼働率** | ≥99.5% | P2 | 四半期 |
| **年間稼働率** | ≥99.0% | P2 | 年次 |
| **計画停止時間** | <8時間/月 | P2 | 月次 |
| **計画外停止時間** | <1時間/月 | P1 | 月次 |

**稼働率計算式**:
```
稼働率 = (総時間 - 停止時間) / 総時間 × 100%
```

---

#### 4.1.2 サービスレベル目標（SLO）

| サービス | SLI（指標） | SLO（目標） | 優先度 |
|---------|-----------|-----------|--------|
| **予測API** | 成功率 | ≥99.9% | P0 |
| **学習処理** | 完了率 | ≥98% | P1 |
| **データベース** | クエリ成功率 | ≥99.99% | P0 |
| **UI応答** | 応答率 | ≥99% | P2 |

---

### 4.2 信頼性要件

#### 4.2.1 障害対応時間

| 項目 | 目標値 | 優先度 | 測定方法 |
|-----|--------|--------|---------|
| **MTBF** (Mean Time Between Failures) | >720時間 (30日) | P1 | 障害ログ分析 |
| **MTTR** (Mean Time To Repair) | <1時間 | P1 | 障害対応時間測定 |
| **MTTD** (Mean Time To Detect) | <10分 | P1 | アラート発火時間 |
| **MTTF** (Mean Time To Failure) | >1,440時間 (60日) | P2 | 障害間隔測定 |

---

#### 4.2.2 データ整合性

| 項目 | 要件 | 優先度 | 検証方法 |
|-----|------|--------|---------|
| **実験データ整合性** | 100% | P0 | チェックサム検証 |
| **モデルバージョン整合性** | 100% | P0 | バージョン照合 |
| **予測結果整合性** | 100% | P0 | 再現性テスト |
| **トランザクション整合性** | ACID保証 | P0 | データベーステスト |

---

#### 4.2.3 エラー処理

| エラータイプ | 処理方法 | リトライ | 優先度 |
|-----------|---------|---------|--------|
| **一時的なネットワークエラー** | 自動リトライ (3回) | あり | P0 |
| **データ検証エラー** | エラーログ出力、処理中断 | なし | P0 |
| **リソース不足エラー** | 待機後リトライ | あり | P1 |
| **モデル学習失敗** | エラーログ、次モデルへ | なし | P1 |
| **データベース接続エラー** | 自動リトライ (5回) | あり | P0 |

**リトライポリシー**:
```python
# エクスポネンシャルバックオフ
retry_config = {
    "max_attempts": 3,
    "initial_delay_seconds": 1,
    "max_delay_seconds": 60,
    "exponential_base": 2,
    "jitter": True
}

# 例: 1秒 → 2秒 → 4秒 (±jitter)
```

---

### 4.3 フォールトトレランス

#### 4.3.1 障害回復戦略

| 障害タイプ | 検出方法 | 回復方法 | RTO | RPO |
|----------|---------|---------|-----|-----|
| **プロセスクラッシュ** | ヘルスチェック | 自動再起動 | <5分 | 0 |
| **データベース障害** | 接続監視 | フェイルオーバー | <10分 | <1分 |
| **ディスク満杯** | 容量監視 | アラート+手動対応 | <30分 | 0 |
| **メモリリーク** | メモリ監視 | プロセス再起動 | <10分 | 0 |
| **ネットワーク障害** | ping監視 | 自動リトライ | <1分 | 0 |

**RTO** (Recovery Time Objective): 目標復旧時間
**RPO** (Recovery Point Objective): 目標復旧時点

---

#### 4.3.2 グレースフルデグラデーション

```python
# 段階的な機能縮退
degradation_levels = [
    {
        "level": "NORMAL",
        "features": ["全機能利用可能"],
        "trigger": "リソース使用率 < 80%"
    },
    {
        "level": "DEGRADED",
        "features": ["並列実行数削減", "キャッシュ有効化"],
        "trigger": "リソース使用率 80-95%"
    },
    {
        "level": "CRITICAL",
        "features": ["新規実行停止", "予測のみ許可"],
        "trigger": "リソース使用率 > 95%"
    },
    {
        "level": "EMERGENCY",
        "features": ["読み取り専用モード"],
        "trigger": "システム障害検出"
    }
]
```

---

### 4.4 バックアップ・リカバリ

#### 4.4.1 バックアップ要件

| 対象 | 頻度 | 保持期間 | 方式 | 優先度 |
|-----|------|---------|------|--------|
| **データベース** | 日次 | 30日 | フル+増分 | P0 |
| **モデルファイル** | 実行時 | 90日 | フル | P1 |
| **設定ファイル** | 変更時 | 永続 | Git | P1 |
| **ログファイル** | 週次 | 90日 | 圧縮アーカイブ | P2 |
| **実験結果** | 実行時 | 180日 | フル | P1 |

---

#### 4.4.2 リカバリテスト

| テスト項目 | 頻度 | 目標復旧時間 | 成功基準 |
|----------|------|------------|---------|
| **データベース復旧** | 月次 | <30分 | データ整合性100% |
| **モデル復旧** | 四半期 | <10分 | モデル動作確認 |
| **システム全体復旧** | 四半期 | <2時間 | 全機能動作確認 |

---

## 5. セキュリティ要件

### 5.1 認証・認可

#### 5.1.1 認証要件

| 項目 | 要件 | 実装方式 | 優先度 |
|-----|------|---------|--------|
| **ローカル実行時** | 認証不要 | なし | P0 |
| **API実行時** | トークンベース認証 | JWT | P3 |
| **マルチユーザー時** | ユーザー認証 | OAuth 2.0 | P3 |
| **パスワードポリシー** | 将来実装 | - | P3 |

**注**: 現バージョンはローカル単一ユーザー想定のため、認証機能は最小限

---

#### 5.1.2 認可要件

| 項目 | 要件 | 優先度 |
|-----|------|--------|
| **ローカル実行時** | 全権限 | P0 |
| **APIアクセス時** | エンドポイント別権限 | P3 |
| **データアクセス制御** | 将来実装 | P3 |

---

### 5.2 秘密情報管理

#### 5.2.1 秘密情報の種類

| 秘密情報 | 管理方法 | 優先度 |
|---------|---------|--------|
| **データベースパスワード** | 環境変数 | P0 |
| **APIキー** (MLflow, W&B) | 環境変数 | P1 |
| **暗号化キー** | 環境変数/KMS | P2 |
| **接続文字列** | 環境変数 | P0 |

---

#### 5.2.2 秘密情報管理のベストプラクティス

```python
# ✅ 良い例: 環境変数から読み込み
import os
from dotenv import load_dotenv

load_dotenv()

DATABASE_URL = os.getenv("DATABASE_URL")
MLFLOW_TRACKING_URI = os.getenv("MLFLOW_TRACKING_URI")
WANDB_API_KEY = os.getenv("WANDB_API_KEY")


# ❌ 悪い例: ハードコード
DATABASE_URL = "postgresql://user:password@localhost:5432/db"  # 絶対禁止
API_KEY = "sk-1234567890abcdef"  # 絶対禁止
```

**要件**:
- ソースコードに秘密情報を含めない（P0）
- `.env`ファイルを`.gitignore`に追加（P0）
- 本番環境では環境変数を使用（P0）

---

### 5.3 データ保護

#### 5.3.1 個人情報（PII）対策

| 項目 | 要件 | 優先度 |
|-----|------|--------|
| **PII検出** | デフォルト未実装 | P3 |
| **PII匿名化** | 必要時に実装 | P3 |
| **PII削除** | 必要時に実装 | P3 |
| **PII暗号化** | 必要時に実装 | P3 |

**注**: デフォルトではPII処理は行わない。必要に応じて拡張実装可能。

---

#### 5.3.2 データ暗号化

| 対象 | 暗号化方式 | 優先度 |
|-----|-----------|--------|
| **転送中データ** | TLS 1.3 (API使用時) | P2 |
| **保存データ** | ファイルシステム暗号化 | P3 |
| **データベース** | PostgreSQL暗号化 | P3 |
| **バックアップ** | AES-256 | P3 |

---

### 5.4 脆弱性対策

#### 5.4.1 一般的な脆弱性対策

| 脆弱性 | 対策 | 優先度 |
|-------|------|--------|
| **SQLインジェクション** | パラメータ化クエリ | P0 |
| **XSS** | 入力サニタイゼーション | P1 |
| **CSRF** | CSRFトークン | P2 |
| **パストラバーサル** | パス検証 | P0 |
| **コマンドインジェクション** | 入力検証 | P0 |

---

#### 5.4.2 依存関係の脆弱性管理

```bash
# 定期的な脆弱性スキャン
pip-audit  # Python依存関係スキャン
safety check  # セキュリティ脆弱性チェック
bandit -r src/  # コードセキュリティスキャン

# 頻度: 週次
# アラート: Critical/High脆弱性は即時対応
```

---

### 5.5 監査・ロギング

#### 5.5.1 セキュリティログ

| イベント | ログレベル | 記録内容 | 保持期間 |
|---------|----------|---------|---------|
| **認証失敗** | WARNING | ユーザー、時刻、IPアドレス | 90日 |
| **権限エラー** | WARNING | ユーザー、リソース、時刻 | 90日 |
| **データアクセス** | INFO | ユーザー、データセット、時刻 | 30日 |
| **設定変更** | INFO | 変更内容、ユーザー、時刻 | 180日 |
| **システムエラー** | ERROR | エラー詳細、スタックトレース | 90日 |

---

## 6. 保守性・拡張性要件

### 6.1 コード品質要件

#### 6.1.1 静的解析基準

| メトリクス | 目標値 | 測定ツール | 優先度 |
|----------|--------|-----------|--------|
| **Pylintスコア** | ≥8.5/10 | pylint | P0 |
| **型チェック** | エラー0件 | mypy --strict | P0 |
| **循環的複雑度** | ≤10 | radon cc | P1 |
| **重複コード率** | <3% | pylint duplicate-code | P1 |
| **行数/関数** | ≤50行 | radon raw | P2 |
| **引数/関数** | ≤7個 | 手動レビュー | P2 |

---

#### 6.1.2 テストカバレッジ要件

| 層 | カバレッジ目標 | 優先度 |
|----|--------------|--------|
| **Configuration層** | >95% | P0 |
| **Data層** | >95% | P0 |
| **Model Discovery層** | >90% | P1 |
| **Hyperparameter層** | >90% | P1 |
| **Execution Plan層** | >90% | P1 |
| **Execution層** | >85% | P1 |
| **Artifact層** | >90% | P1 |
| **Logging層** | >90% | P1 |
| **Service層** | >85% | P1 |
| **Application層** | >85% | P2 |
| **全体** | >90% | P0 |

---

#### 6.1.3 ドキュメント要件

| ドキュメント | カバレッジ | 形式 | 優先度 |
|------------|-----------|------|--------|
| **公開API** | 100% | docstring | P0 |
| **内部関数** | >80% | docstring | P1 |
| **クラス** | 100% | docstring | P0 |
| **モジュール** | 100% | docstring | P0 |
| **README** | 必須 | Markdown | P0 |
| **設計書** | 必須 | Markdown | P0 |
| **API仕様** | 必須 | OpenAPI/Swagger | P1 |

**docstring形式**: Google Style

```python
def calculate_metrics(
    y_true: np.ndarray,
    y_pred: np.ndarray,
    *,
    metrics: List[str] = ["mae", "rmse"]
) -> Dict[str, float]:
    """
    評価指標を計算する
    
    Args:
        y_true: 真の値
        y_pred: 予測値
        metrics: 計算する指標のリスト
    
    Returns:
        指標名と値の辞書
    
    Raises:
        ValueError: 入力配列の形状が一致しない場合
    
    Examples:
        >>> y_true = np.array([1, 2, 3])
        >>> y_pred = np.array([1.1, 2.1, 2.9])
        >>> metrics = calculate_metrics(y_true, y_pred)
        >>> metrics
        {'mae': 0.1, 'rmse': 0.1}
    """
```

---

### 6.2 拡張性要件

#### 6.2.1 プラグイン対応

| 拡張ポイント | インターフェース | 優先度 |
|------------|----------------|--------|
| **モデル追加** | BaseModel | P0 |
| **損失関数追加** | BaseLoss | P1 |
| **スケーラー追加** | BaseScaler | P1 |
| **探索アルゴリズム追加** | BaseSearchAlgorithm | P2 |
| **トラッキングバックエンド追加** | BaseTracker | P2 |
| **データソース追加** | BaseDataLoader | P2 |

**設計原則**:
- Open/Closed Principle: 拡張に開き、修正に閉じる
- Dependency Inversion: 抽象に依存、具象に依存しない

---

#### 6.2.2 モジュール独立性

```python
# モジュール依存関係の制約
module_dependencies = {
    "config": [],  # 依存なし
    "data": ["config"],
    "model": ["config"],
    "hyperparameter": ["config", "model"],
    "execution": ["config", "data", "model", "hyperparameter"],
    "artifact": ["config"],
    "logging": ["config"],
    "service": ["config", "data", "model", "execution", "artifact", "logging"],
    "app": ["service"]
}
```

**要件**:
- 循環依存の禁止（P0）
- 下位層から上位層への依存禁止（P0）
- 隣接層以外への直接依存は最小限（P1）

---

### 6.3 保守性要件

#### 6.3.1 コード変更容易性

| 項目 | 要件 | 優先度 |
|-----|------|--------|
| **新規モデル追加時間** | <4時間 | P1 |
| **新規損失関数追加時間** | <2時間 | P2 |
| **バグ修正時間** | <1日 | P1 |
| **機能追加時間** | <2週間/中規模機能 | P2 |

---

#### 6.3.2 依存関係管理

```toml
# pyproject.toml
[project]
name = "nf-auto-runner"
version = "1.0.0"
requires-python = ">=3.11"

dependencies = [
    "neuralforecast>=1.6.0",
    "pandas>=2.0.0",
    "numpy>=1.24.0",
    "sqlalchemy>=2.0.0",
    "pydantic>=2.0.0",
    "hydra-core>=1.3.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=7.4.0",
    "pytest-cov>=4.1.0",
    "pylint>=3.0.0",
    "mypy>=1.7.0",
    "black>=23.0.0",
]

mlflow = [
    "mlflow>=2.8.0",
]

wandb = [
    "wandb>=0.16.0",
]
```

**バージョニングポリシー**:
- セマンティックバージョニング（Major.Minor.Patch）
- Major: 破壊的変更
- Minor: 機能追加（後方互換性あり）
- Patch: バグ修正

---

## 7. ユーザビリティ要件

### 7.1 使いやすさ要件

#### 7.1.1 CLI使いやすさ

| 項目 | 要件 | 優先度 |
|-----|------|--------|
| **ヘルプの充実度** | すべてのコマンドにヘルプ | P0 |
| **エラーメッセージの明確性** | 原因と対処法を明示 | P0 |
| **デフォルト値の妥当性** | 80%のケースで変更不要 | P1 |
| **進捗表示** | tqdm/rich使用 | P1 |
| **自動補完** | Tab補完対応 | P2 |

---

#### 7.1.2 UI/UX要件

| 項目 | 要件 | 優先度 |
|-----|------|--------|
| **画面遷移速度** | <1秒 | P1 |
| **グラフ描画速度** | <2秒 | P1 |
| **エラー表示** | ユーザーフレンドリーなメッセージ | P1 |
| **レスポンシブデザイン** | 将来対応 | P3 |

---

### 7.2 学習容易性

#### 7.2.1 ドキュメント要件

| ドキュメント | 要件 | 優先度 |
|------------|------|--------|
| **クイックスタートガイド** | 30分で実行可能 | P0 |
| **チュートリアル** | 主要ユースケース網羅 | P1 |
| **API リファレンス** | 全公開API | P0 |
| **FAQ** | よくある質問30件以上 | P2 |
| **トラブルシューティング** | 主要エラーの対処法 | P1 |

---

#### 7.2.2 サンプルコード

```python
# サンプルコードの提供
examples = [
    "examples/01_basic_training.py",  # 基本的な学習
    "examples/02_hyperparameter_search.py",  # ハイパーパラメータ探索
    "examples/03_batch_prediction.py",  # バッチ予測
    "examples/04_model_registry.py",  # モデルレジストリ
    "examples/05_custom_model.py",  # カスタムモデル追加
    "examples/06_mlflow_integration.py",  # MLflow統合
]
```

**要件**:
- すべてのサンプルが実行可能（P0）
- コメント付き（P0）
- エラーハンドリング含む（P1）

---

### 7.3 操作性要件

#### 7.3.1 コマンド設計

```bash
# 一貫性のあるコマンド設計
nf-runner train --config config.yaml  # 学習実行
nf-runner predict --model model.pkl --data data.csv  # 予測実行
nf-runner evaluate --run-id abc123  # 評価実行
nf-runner registry list  # モデル一覧
nf-runner registry promote --model-id xyz789  # モデル昇格

# 省略形サポート
nf-runner -c config.yaml  # --config の省略形
nf-runner -m model.pkl -d data.csv  # 複数の省略形
```

**要件**:
- 動詞-名詞パターン（P1）
- 省略形の提供（P2）
- Tab補完対応（P2）

---

## 8. 互換性要件

### 8.1 後方互換性

#### 8.1.1 APIバージョニング

| 項目 | 要件 | 優先度 |
|-----|------|--------|
| **APIバージョン管理** | セマンティックバージョニング | P0 |
| **後方互換性維持期間** | 2メジャーバージョン | P1 |
| **非推奨機能の警告期間** | 1メジャーバージョン | P1 |
| **移行ガイドの提供** | メジャーバージョンアップ時 | P0 |

---

#### 8.1.2 データ互換性

| 項目 | 要件 | 優先度 |
|-----|------|--------|
| **データベーススキーマ** | マイグレーションスクリプト提供 | P0 |
| **モデルフォーマット** | 後方互換性維持 | P1 |
| **設定ファイル** | 自動移行機能 | P1 |

---

### 8.2 プラットフォーム互換性

#### 8.2.1 OS互換性

| OS | サポート | 優先度 |
|----|---------|--------|
| **Linux** (Ubuntu 20.04+) | 完全サポート | P0 |
| **macOS** (12+) | 完全サポート | P0 |
| **Windows** (10+) | ベストエフォート | P2 |

---

#### 8.2.2 Pythonバージョン互換性

| Python | サポート | 優先度 |
|--------|---------|--------|
| **3.11** | 完全サポート | P0 |
| **3.12** | 完全サポート | P1 |
| **3.10** | ベストエフォート | P2 |

---

### 8.3 ライブラリ互換性

#### 8.3.1 主要依存関係

| ライブラリ | バージョン範囲 | 優先度 |
|----------|--------------|--------|
| **neuralforecast** | >=1.6.0, <2.0.0 | P0 |
| **pandas** | >=2.0.0, <3.0.0 | P0 |
| **numpy** | >=1.24.0, <2.0.0 | P0 |
| **PyTorch** | >=2.0.0, <3.0.0 | P0 |
| **SQLAlchemy** | >=2.0.0, <3.0.0 | P0 |

---

## 9. 運用要件

### 9.1 デプロイメント要件

#### 9.1.1 デプロイ方法

| 方法 | サポート | 優先度 |
|-----|---------|--------|
| **ローカルインストール** | pip install | P0 |
| **Docker** | Dockerfile提供 | P1 |
| **Docker Compose** | docker-compose.yml提供 | P1 |
| **Kubernetes** | Helmチャート | P3 |

---

#### 9.1.2 デプロイ時間

| 項目 | 目標値 | 優先度 |
|-----|--------|--------|
| **初回セットアップ時間** | <30分 | P1 |
| **アップデート時間** | <5分 | P1 |
| **ロールバック時間** | <10分 | P2 |

---

### 9.2 監視要件

#### 9.2.1 システム監視

| 監視項目 | 監視間隔 | アラート閾値 | 優先度 |
|---------|---------|------------|--------|
| **CPU使用率** | 1分 | >90% for 5分 | P1 |
| **メモリ使用率** | 1分 | >90% for 5分 | P1 |
| **ディスク使用率** | 5分 | >85% | P1 |
| **GPU使用率** | 1分 | >95% for 5分 | P2 |
| **プロセス稼働状態** | 1分 | Down | P0 |
| **ネットワーク** | 1分 | Unreachable for 3分 | P2 |

---

#### 9.2.2 アプリケーション監視

| 監視項目 | 監視間隔 | アラート閾値 | 優先度 |
|---------|---------|------------|--------|
| **実行中Run数** | 1分 | >100 | P2 |
| **失敗Run率** | 5分 | >10% | P1 |
| **平均実行時間** | 1時間 | 前週比+50% | P2 |
| **キュー待ちジョブ数** | 1分 | >50 | P2 |
| **API応答時間** | 1分 | p95>1秒 | P1 |
| **エラー率** | 5分 | >5% | P0 |

---

### 9.3 保守運用

#### 9.3.1 定期メンテナンス

| タスク | 頻度 | 所要時間 | 優先度 |
|-------|------|---------|--------|
| **ログローテーション** | 週次 | <5分 | P1 |
| **データベースVACUUM** | 週次 | <30分 | P1 |
| **古いモデル削除** | 月次 | <1時間 | P2 |
| **バックアップ検証** | 月次 | <30分 | P1 |
| **依存関係更新** | 月次 | <2時間 | P2 |
| **セキュリティパッチ** | 随時 | <4時間 | P0 |

---

#### 9.3.2 運用ドキュメント

| ドキュメント | 内容 | 優先度 |
|------------|------|--------|
| **運用手順書** | 日常運用タスク | P0 |
| **障害対応手順書** | 障害パターン別対応 | P0 |
| **バックアップ・リカバリ手順** | 詳細手順 | P0 |
| **パフォーマンスチューニングガイド** | 最適化手法 | P2 |

---

## 10. データ管理要件

### 10.1 データ保持要件

#### 10.1.1 データ保持期間

| データタイプ | 保持期間 | 削除方法 | 優先度 |
|-----------|---------|---------|--------|
| **実験データ** | 180日 | 自動削除 | P1 |
| **Runデータ** | 180日 | 自動削除 | P1 |
| **モデルファイル** (Development) | 30日 | 自動削除 | P2 |
| **モデルファイル** (Staging) | 90日 | 手動削除 | P1 |
| **モデルファイル** (Production) | 365日 | 手動削除 | P0 |
| **ログファイル** | 90日 | 自動削除 | P1 |
| **バックアップ** | 30日 | 自動削除 | P0 |
| **監査ログ** | 180日 | 手動削除 | P2 |

---

#### 10.1.2 データライフサイクル

```python
# データライフサイクルポリシー
data_lifecycle_policies = {
    "hot": {
        "duration": "30日",
        "storage": "SSD",
        "access": "頻繁",
        "description": "アクティブな実験・モデル"
    },
    "warm": {
        "duration": "30-90日",
        "storage": "SSD",
        "access": "時々",
        "description": "最近の実験・モデル"
    },
    "cold": {
        "duration": "90-180日",
        "storage": "HDD/圧縮",
        "access": "稀",
        "description": "古い実験・モデル"
    },
    "archived": {
        "duration": ">180日",
        "storage": "削除 or 外部ストレージ",
        "access": "なし",
        "description": "アーカイブ or 削除"
    }
}
```

---

### 10.2 データ品質要件

#### 10.2.1 データ検証

| 検証項目 | 検証方法 | 優先度 |
|---------|---------|--------|
| **必須カラム存在** | スキーマ検証 | P0 |
| **データ型一致** | 型チェック | P0 |
| **欠損値率** | <30% | P1 |
| **外れ値検出** | IQR/Z-score | P2 |
| **時系列連続性** | 日付連続性チェック | P1 |
| **unique_id一貫性** | 一意性チェック | P0 |

---

#### 10.2.2 データ品質メトリクス

```python
class DataQualityMetrics:
    """データ品質メトリクス"""
    
    completeness: float  # 完全性（欠損なし比率）
    consistency: float  # 一貫性（ルール違反なし比率）
    accuracy: float  # 正確性（検証済み比率）
    timeliness: float  # 適時性（最新データ比率）
    uniqueness: float  # 一意性（重複なし比率）
    validity: float  # 妥当性（フォーマット適合比率）
    
    # 目標値
    TARGET_COMPLETENESS = 0.95
    TARGET_CONSISTENCY = 0.99
    TARGET_VALIDITY = 0.99
```

---

### 10.3 データガバナンス

#### 10.3.1 メタデータ管理

| メタデータ | 必須 | 説明 |
|----------|------|------|
| **データソース** | ✓ | データの出所 |
| **作成日時** | ✓ | データ作成日時 |
| **バージョン** | ✓ | データバージョン |
| **スキーマ** | ✓ | カラム定義 |
| **統計情報** | - | 基本統計量 |
| **品質スコア** | - | データ品質メトリクス |
| **所有者** | - | データ所有者 |
| **更新頻度** | - | 更新頻度 |

---

## 11. 監視・ロギング要件

### 11.1 ロギング要件

#### 11.1.1 ログレベル

| レベル | 用途 | 例 |
|-------|------|---|
| **CRITICAL** | システムクラッシュ | データベース接続不可 |
| **ERROR** | エラーだが継続可能 | モデル学習失敗 |
| **WARNING** | 警告 | メモリ使用量高い |
| **INFO** | 通常動作の記録 | モデル学習開始 |
| **DEBUG** | デバッグ情報 | 変数値、関数呼び出し |

---

#### 11.1.2 ログフォーマット

```json
{
  "timestamp": "2025-11-03T12:34:56.789Z",
  "level": "INFO",
  "logger": "nf_auto_runner.service.execution",
  "message": "Model training started",
  "context": {
    "run_id": "abc123",
    "model_name": "AutoNHITS",
    "dataset_version": "v1.0",
    "user_id": "user123"
  },
  "metadata": {
    "hostname": "server01",
    "process_id": 12345,
    "thread_id": 67890
  }
}
```

**要件**:
- JSON形式（P1）
- ISO 8601日時形式（P0）
- 構造化ロギング（P1）
- コンテキスト情報含む（P1）

---

#### 11.1.3 ログ出力先

| 出力先 | 用途 | ローテーション | 優先度 |
|-------|------|--------------|--------|
| **ファイル** | 永続化 | 日次 or 100MB | P0 |
| **標準出力** | リアルタイム確認 | なし | P0 |
| **Loki** | 集約・検索 | サーバー側 | P2 |
| **Elasticsearch** | 分析 | サーバー側 | P3 |

---

### 11.2 メトリクス収集

#### 11.2.1 収集メトリクス

| カテゴリ | メトリクス | 収集間隔 | 優先度 |
|---------|----------|---------|--------|
| **システム** | CPU/メモリ/ディスク/GPU | 1分 | P1 |
| **アプリケーション** | 実行中Run数、キュー長 | 1分 | P1 |
| **パフォーマンス** | 学習時間、予測レイテンシ | 実行時 | P1 |
| **ビジネス** | 1日あたり学習数、精度 | 1時間 | P2 |
| **品質** | エラー率、成功率 | 5分 | P1 |

---

#### 11.2.2 メトリクス形式

```python
# Prometheusメトリクス形式
training_time_seconds = Histogram(
    'training_time_seconds',
    'Model training time in seconds',
    ['model_name', 'dataset_size']
)

prediction_latency_ms = Histogram(
    'prediction_latency_milliseconds',
    'Prediction latency in milliseconds',
    ['model_name', 'batch_size']
)

active_runs = Gauge(
    'active_runs_total',
    'Number of currently active runs'
)

failed_runs_total = Counter(
    'failed_runs_total',
    'Total number of failed runs',
    ['error_type']
)
```

---

### 11.3 アラート要件

#### 11.3.1 アラートルール

| アラート | 条件 | 重要度 | 通知先 |
|---------|------|-------|-------|
| **システムダウン** | プロセス停止 | Critical | Email, Slack |
| **メモリ不足** | メモリ使用率>95% | High | Email, Slack |
| **ディスク満杯** | ディスク使用率>90% | High | Email, Slack |
| **高エラー率** | エラー率>10% for 5分 | High | Email |
| **実行時間異常** | 実行時間>2x平均 | Medium | Slack |
| **キュー滞留** | キュー>50 for 10分 | Medium | Slack |

---

#### 11.3.2 アラート通知フォーマット

```
【Critical】システムダウン検出

Time: 2025-11-03 12:34:56 JST
Service: nf-auto-runner
Host: server01
Status: DOWN

Details:
- Process: nf-runner (PID 12345) has stopped
- Last seen: 2025-11-03 12:30:00 JST
- Uptime before failure: 72h 15m

Actions:
1. Check logs: /var/log/nf-runner/error.log
2. Restart: systemctl restart nf-runner
3. Verify: systemctl status nf-runner

Dashboard: https://grafana.example.com/d/nf-runner
```

---

### 11.4 トレーシング

#### 11.4.1 分散トレーシング

| 項目 | 要件 | ツール | 優先度 |
|-----|------|-------|--------|
| **トレース収集** | 主要処理を追跡 | OpenTelemetry | P3 |
| **スパン生成** | 関数単位 | - | P3 |
| **コンテキスト伝播** | Run ID伝播 | - | P2 |
| **サンプリング** | 10-100% | - | P3 |

---

## 12. 品質属性

### 12.1 ISO 25010品質特性マッピング

| 品質特性 | 副特性 | 評価メトリクス | 目標値 |
|---------|-------|--------------|--------|
| **機能適合性** | 機能完全性 | 機能実装率 | 100% |
| | 機能正確性 | テストケース合格率 | >99% |
| | 機能適切性 | ユーザー満足度 | >4.0/5.0 |
| **性能効率性** | 時間効率性 | 応答時間 | 各要件参照 |
| | 資源効率性 | リソース使用率 | 各要件参照 |
| | 容量 | スケーラビリティ | 各要件参照 |
| **互換性** | 共存性 | 他システムとの共存 | 問題なし |
| | 相互運用性 | API互換性 | 100% |
| **ユーザビリティ** | 認識性 | タスク完了率 | >90% |
| | 学習性 | 学習時間 | <30分 |
| | 操作性 | タスク効率 | >80% |
| | エラー防止 | エラー発生率 | <5% |
| **信頼性** | 成熟性 | 障害発生率 | <1回/月 |
| | 可用性 | 稼働率 | >99% |
| | 障害許容性 | MTTR | <1時間 |
| | 回復性 | 復旧時間 | 各要件参照 |
| **セキュリティ** | 機密性 | 情報漏洩数 | 0件 |
| | 完全性 | データ改ざん数 | 0件 |
| | 否認防止性 | 監査証跡 | 100% |
| | 真正性 | 認証成功率 | >99.9% |
| **保守性** | モジュール性 | 結合度 | 低 |
| | 再利用性 | コード再利用率 | >30% |
| | 解析性 | コード理解時間 | <2時間/1000行 |
| | 修正性 | バグ修正時間 | <1日 |
| | 試験性 | テストカバレッジ | >90% |
| **移植性** | 適応性 | 環境移行時間 | <1日 |
| | 設置性 | インストール時間 | <30分 |
| | 置換性 | コンポーネント交換時間 | <1日 |

---

### 12.2 品質ゲート

#### 12.2.1 リリース前品質ゲート

| ゲート | 基準 | 必須 |
|-------|------|------|
| **コードレビュー** | 2名以上のApproval | ✓ |
| **テストカバレッジ** | >90% | ✓ |
| **静的解析** | Pylint ≥8.5 | ✓ |
| **型チェック** | MyPy エラー0件 | ✓ |
| **セキュリティスキャン** | Critical脆弱性0件 | ✓ |
| **パフォーマンステスト** | 要件達成 | ✓ |
| **統合テスト** | 全Pass | ✓ |
| **E2Eテスト** | 全Pass | ✓ |
| **ドキュメント** | 完備 | ✓ |

---

## 13. 制約事項

### 13.1 技術的制約

| 制約 | 説明 | 影響 |
|-----|------|------|
| **Python 3.11以上必須** | 型ヒント機能使用 | 古い環境では動作不可 |
| **PostgreSQL 14以上必須** | JSON機能使用 | 古いバージョンでは動作不可 |
| **GPU必須ではない** | CPUでも動作 | 性能は低下 |
| **ローカル実行想定** | クラウド未対応（将来拡張可能） | 分散環境では追加実装必要 |

---

### 13.2 ビジネス制約

| 制約 | 説明 | 対応 |
|-----|------|------|
| **予算制限** | 商用ツール使用最小限 | OSS中心 |
| **リリース期限** | 3ヶ月以内 | MVP優先 |
| **リソース制限** | 開発者2-3名 | 機能優先順位付け |

---

### 13.3 運用制約

| 制約 | 説明 | 対応 |
|-----|------|------|
| **24/7運用不要** | 営業時間内運用 | 夜間メンテナンス可 |
| **専任運用者なし** | 開発者が運用兼任 | 自動化重視 |
| **サポート体制** | ベストエフォート | ドキュメント充実化 |

---

## 14. 測定・検証方法

### 14.1 パフォーマンス測定

#### 14.1.1 測定ツール

```python
# パフォーマンス測定スクリプト
import time
import psutil
from contextlib import contextmanager


@contextmanager
def measure_performance(name: str):
    """パフォーマンス測定コンテキストマネージャ"""
    # 開始時点
    start_time = time.perf_counter()
    start_memory = psutil.virtual_memory().used / (1024 ** 3)  # GB
    
    try:
        yield
    finally:
        # 終了時点
        end_time = time.perf_counter()
        end_memory = psutil.virtual_memory().used / (1024 ** 3)  # GB
        
        # 結果
        elapsed_time = end_time - start_time
        memory_used = end_memory - start_memory
        
        print(f"{name}:")
        print(f"  Time: {elapsed_time:.2f} seconds")
        print(f"  Memory: {memory_used:.2f} GB")


# 使用例
with measure_performance("Model Training"):
    model.fit(X_train, y_train)
```

---

#### 14.1.2 ベンチマークスイート

```python
# benchmark/suite.py

class BenchmarkSuite:
    """ベンチマークスイート"""
    
    def run_all_benchmarks(self):
        """すべてのベンチマークを実行"""
        results = {}
        
        # 1. データ読み込みベンチマーク
        results['data_loading'] = self.benchmark_data_loading()
        
        # 2. 学習ベンチマーク
        results['training'] = self.benchmark_training()
        
        # 3. 予測ベンチマーク
        results['prediction'] = self.benchmark_prediction()
        
        # 4. 並列実行ベンチマーク
        results['parallel'] = self.benchmark_parallel()
        
        # レポート生成
        self.generate_report(results)
        
        return results
```

---

### 14.2 品質測定

#### 14.2.1 品質メトリクスダッシュボード

```python
# 品質メトリクスの収集
quality_metrics = {
    "code_quality": {
        "pylint_score": 8.7,
        "mypy_errors": 0,
        "complexity": {
            "avg": 4.2,
            "max": 9
        },
        "duplication": "2.1%"
    },
    "test_quality": {
        "coverage": 92.5,
        "unit_tests": 523,
        "integration_tests": 78,
        "e2e_tests": 12,
        "mutation_score": 82.3
    },
    "documentation": {
        "docstring_coverage": 95.2,
        "api_docs": "complete",
        "examples": 15
    },
    "security": {
        "vulnerabilities": {
            "critical": 0,
            "high": 0,
            "medium": 2,
            "low": 5
        },
        "dependency_issues": 0
    }
}
```

---

### 14.3 受け入れ基準

#### 14.3.1 受け入れテスト項目

| カテゴリ | 項目 | 合格基準 |
|---------|------|---------|
| **機能** | 全機能要件実装 | 100% |
| **性能** | パフォーマンス要件達成 | 100% |
| **品質** | テストカバレッジ | >90% |
| **品質** | コード品質 | Pylint ≥8.5 |
| **セキュリティ** | 脆弱性 | Critical/High 0件 |
| **ドキュメント** | 必須ドキュメント | 完備 |
| **ユーザビリティ** | クイックスタート動作 | 30分以内 |

---

## 15. 付録

### 15.1 用語集

| 用語 | 定義 |
|-----|------|
| **NFR** | Non-Functional Requirements（非機能要件） |
| **SLA** | Service Level Agreement（サービスレベル契約） |
| **SLO** | Service Level Objective（サービスレベル目標） |
| **SLI** | Service Level Indicator（サービスレベル指標） |
| **MTBF** | Mean Time Between Failures（平均故障間隔） |
| **MTTR** | Mean Time To Repair（平均修復時間） |
| **MTTD** | Mean Time To Detect（平均検出時間） |
| **MTTF** | Mean Time To Failure（平均故障時間） |
| **RTO** | Recovery Time Objective（目標復旧時間） |
| **RPO** | Recovery Point Objective（目標復旧時点） |

---

### 15.2 参考文献

1. **ISO/IEC 25010:2011** - Systems and software Quality Requirements and Evaluation (SQuaRE)
2. **Google SRE Book** - Site Reliability Engineering
3. **NIST Cybersecurity Framework** - セキュリティフレームワーク
4. **The Twelve-Factor App** - モダンアプリケーション設計原則

---

### 15.3 非機能要件チェックリスト

```markdown
## リリース前チェックリスト

### パフォーマンス
- [ ] 学習時間要件達成
- [ ] 予測レイテンシ要件達成
- [ ] メモリ使用量要件達成
- [ ] 並列実行性能要件達成

### スケーラビリティ
- [ ] 負荷テスト完了
- [ ] 大規模データセットテスト完了
- [ ] 並列実行テスト完了

### 可用性・信頼性
- [ ] エラーハンドリング実装
- [ ] リトライ機能実装
- [ ] バックアップ機能実装
- [ ] 復旧手順確認

### セキュリティ
- [ ] 脆弱性スキャン完了
- [ ] 秘密情報管理確認
- [ ] セキュリティログ実装

### 保守性
- [ ] コードカバレッジ>90%
- [ ] Pylintスコア≥8.5
- [ ] ドキュメント完備
- [ ] 静的解析pass

### ユーザビリティ
- [ ] クイックスタートガイド作成
- [ ] エラーメッセージ改善
- [ ] ヘルプ充実

### 監視・ロギング
- [ ] 監視設定完了
- [ ] アラート設定完了
- [ ] ログ出力確認
- [ ] メトリクス収集確認

### 運用
- [ ] 運用手順書作成
- [ ] 障害対応手順書作成
- [ ] デプロイ手順確認
```

---

### 15.4 関連ドキュメント

- 📄 `01_REQUIREMENTS_SPECIFICATION_DETAILED.md` - 機能要件詳細
- 📄 `03_ARCHITECTURE_DESIGN_DETAILED.md` - アーキテクチャ設計
- 📄 `09_TESTING_STRATEGY.md` - テスト戦略
- 📄 `10_DEPLOYMENT_GUIDE.md` - デプロイガイド
- 📄 `11_OPERATIONS_RUNBOOK.md` - 運用手順書
- 📄 `12_MONITORING_GUIDE.md` - 監視ガイド

---

## ✨ まとめ

本非機能要件定義書は、時系列予測システムの品質特性を包括的に定義しています。

### 非機能要件のハイライト

- ✅ **パフォーマンス**: 単一モデル<10分、100モデル並列<2時間
- ✅ **スケーラビリティ**: 最大1,000万行、10,000 unique_id
- ✅ **可用性**: 月間稼働率≥99%、MTTR<1時間
- ✅ **セキュリティ**: 環境変数管理、脆弱性スキャン
- ✅ **保守性**: カバレッジ>90%、Pylint≥8.5
- ✅ **ユーザビリティ**: 30分でクイックスタート可能
- ✅ **監視**: Prometheus/Grafana統合

### 実装優先順位

1. **P0 (Critical)**: 基本動作必須項目
2. **P1 (High)**: ビジネス価値高、リリース前実装
3. **P2 (Medium)**: あると望ましい
4. **P3 (Low)**: 将来的な改善項目

---

**Quality is not an act, it is a habit! 📊**

---
**End of Document**
